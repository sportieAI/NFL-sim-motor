name: Auto Push to Main Branch

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - "engine/**"
      - "docs/**"
      - "results/**"
      - "docker-compose.yml"
      - "Dockerfile"
      - "requirements.txt"

jobs:
  auto-push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Set up Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      # --- Customize this step with your own automation ---
      - name: Generate artifacts and update files
        run: |
          # Example: Generate a summary of results directory
          SUMMARY_FILE="results/automation-summary.txt"
          echo "Auto-summary for $(date -u)" > "$SUMMARY_FILE"
          echo "Files in results/:" >> "$SUMMARY_FILE"
          find results/ -type f >> "$SUMMARY_FILE"
          echo "---" >> "$SUMMARY_FILE"
          # Example: Count narratives generated
          NARR_COUNT=$(find results/ -type f -name "*.json" | wc -l)
          echo "Total narratives: $NARR_COUNT" >> "$SUMMARY_FILE"
          # Example: Create a timestamp file
          echo "Last automated run: $(date -u)" > results/last_automation_run.txt
          # Add any other artifact/result generation here

      - name: Commit and push changes
        run: |
          git add results/automation-summary.txt results/last_automation_run.txt
          git commit -m "Automated update: artifacts and summary [skip ci]" || echo "No changes to commit"
          git push origin main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

